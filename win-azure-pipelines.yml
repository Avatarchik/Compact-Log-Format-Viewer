# ASP.NET Core
# Build and test ASP.NET Core projects targeting .NET Core.
# Add steps that run tests, create a NuGet package, deploy, and more:
# https://docs.microsoft.com/azure/devops/pipelines/languages/dotnet-core

steps:
- task: DotNetCoreCLI@2
  displayName: 'dotnet restore'
  inputs:
    workingDirectory: LogViewer.Server

- task: DotNetCoreCLI@2
  displayName: 'dotnet build'
  inputs:
    workingDirectory: LogViewer.Server

- task: DotNetCoreCLI@2
  displayName: 'dotnet test'
  inputs:
    command: test
    workingDirectory: LogViewer.Server.Tests

- task: DotNetCoreCLI@2
  displayName: 'dotnet publish - Create Self Contained WebAPI for Windows'
  inputs:
    command: publish
    publishWebProjects: false
    arguments: '-r win10-x64 --output bin/dist/win'
    zipAfterPublish: false
    modifyOutputPath: false
    workingDirectory: LogViewer.Server

- task: Npm@1
  displayName: 'npm install'
  inputs:
    workingDir: LogViewer.Client
    verbose: false

- task: Npm@1
  displayName: 'npm run tsc (TypeScript compile)'
  inputs:
    command: custom
    workingDir: LogViewer.Client
    verbose: false
    customCommand: 'run tsc'

- task: Npm@1
  displayName: 'npm run win (builds window outputs AppX & Installer)'
  inputs:
    command: custom
    workingDir: LogViewer.Client
    verbose: false
    customCommand: 'run win'

- task: CopyFiles@2
  displayName: 'Copy Files to: $(Build.ArtifactStagingDirectory)'
  inputs:
    SourceFolder: '$(Build.SourcesDirectory)/output'
    Contents: |
     *.appx
     *.exe
    TargetFolder: '$(Build.ArtifactStagingDirectory)'
    CleanTargetFolder: true
    OverWrite: true

- task: PublishBuildArtifacts@1
  displayName: 'Publish Artifact: output'
  inputs:
    ArtifactName: output

